<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Aqua Online JS Interpreter</title>
<style>
body {
  margin: 0;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #0a1e3d;
  color: #ffffff;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
}
h1 { font-size: 48px; margin: 0; color: #4fc3f7; }
h2 { font-size: 22px; margin: 5px 0 20px 0; color: #81d4fa; }

.editor-container {
  width: 100%;
  max-width: 900px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.editor {
  width: 100%;
  height: 250px;
  font-family: 'Fira Code', monospace;
  font-size: 16px;
  background: #112244;
  color: #e0f7fa;
  border: none;
  border-radius: 8px;
  padding: 15px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  overflow-y: auto;
  outline: none;
  white-space: pre-wrap;
  word-wrap: break-word;
}

button {
  align-self: flex-start;
  padding: 10px 25px;
  font-size: 16px;
  background: #0288d1;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  color: #ffffff;
  font-weight: bold;
  transition: background 0.2s;
}

button:hover { background: #01579b; }

pre {
  background: #0d274d;
  padding: 15px;
  border-radius: 8px;
  min-height: 150px;
  overflow-x: auto;
  color: #81d4fa;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  white-space: pre-wrap;
}

iframe {
  width: 100%;
  height: 250px;
  border-radius: 8px;
  border: none;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  background: #112244;
}
</style>
</head>
<body>

<h1 style="margin:0; color:#4fc3f7;">Aqua</h1>
<h2>Aqua Online JS Interpreter</h2>

<div class="editor-container">
  <div id="editor" class="editor" contenteditable="true">// Type JS or HTML here
console.log("Hello World");</div>
  <button onclick="runCode()">Run Code</button>
  <pre id="output"></pre>
  <iframe id="htmlPreview"></iframe>
</div>

<script>
// Smart brackets: cursor stays inside
const editor = document.getElementById("editor");
const pairs = {'(': ')', '{': '}', '[': ']', '"': '"', "'": "'"};

editor.addEventListener('keydown', (e) => {
  const sel = window.getSelection();
  const range = sel.getRangeAt(0);

  if(e.key in pairs) {
    e.preventDefault();
    const closing = pairs[e.key];
    const span = document.createTextNode(e.key + closing);
    range.insertNode(span);

    // Place cursor inside brackets
    range.setStart(span, 1);
    range.setEnd(span, 1);
    sel.removeAllRanges();
    sel.addRange(range);
  }
});

// Safe console log
function appendOutput(msg) {
  document.getElementById("output").innerText += msg + "\n";
}

function runCode() {
  const code = editor.innerText;
  document.getElementById("output").innerText = "";

  // Render HTML safely in iframe (ignore inline scripts)
  document.getElementById("htmlPreview").srcdoc = code;

  // Extract JS lines: skip lines starting with < (HTML)
  const jsLines = code.split("\n").filter(line => !line.trim().startsWith("<")).join("\n");

  // Check forbidden commands
  const forbidden = ["eval","Function","fetch","XMLHttpRequest","window.location"];
  for(let f of forbidden){
    if(jsLines.includes(f)){
      appendOutput(`Detected forbidden code: ${f}`);
      return;
    }
  }

  // Run JS safely
  const consoleLog = console.log;
  console.log = function(msg){ appendOutput(msg); consoleLog(msg); };

  try {
    const func = new Function(jsLines);
    func();
  } catch(err){
    appendOutput("Error: " + err);
  }

  console.log = consoleLog;
}
</script>
</body>
</html>
